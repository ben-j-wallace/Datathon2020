---
title: "Model"
author: "Ben Wallace, Lily Zhu"
date: "10/31/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(here)
library(broom)
library(knitr)
library(data.table)
```


```{r read data}
unemployment_change <- fread(here("data", "unemployment-change.csv"))
mobility_avg <- fread(here("data", "mobility-avg.csv")) %>%
  mutate(county = sub_region_2) %>%
  select(-sub_region_2)
socioeconomic <- fread(here("data", "socioeconomic.csv")) %>%
  mutate(county = area_name) %>%
  select(-area_name)
unemployment_change
```

## Merge data

```{r}
merged_data <- unemployment_change %>%
  inner_join(mobility_avg, by = "county") %>%
  inner_join(socioeconomic, by = "county") %>%
  select(-parks_avg, -transit_avg) %>%
  na.omit

set.seed(0)
sample_data <- sample_n(merged_data, 500) 

sample_data
```

```{r}
ggplot(data = sample_data, mapping = aes(x = unemployment_change)) +
  geom_bar()
```

## EDA

```{r}
sample_data %>%
  ggplot(aes(y = unemployment_change, x = retail_avg)) +
  geom_point()
```

```{r}
model <- lm(unemployment_change ~ retail_avg + 
              grocery_avg + 
              parks_avg + 
              transit_avg + 
              workplaces_avg + 
              residential_avg, 
            data = merged_data)

model %>%
  tidy(conf.int = TRUE) %>%
  kable(digits = 3)
```




```{r}
augment(model) %>%
  ggplot(aes(x = .fitted, y = .resid)) +
  geom_point() +
  theme_grey(base_size = 14) +
  labs(x = "Fitted", y = "Residual", title = "Residuals Show No Pattern")
```


## Questions
- What is the relationship between ___ and ___? What does this say about the future of unemployment during the future of this pandemic, which experts believe will continue into the next years?
- Given the relationship between these variables, what is the expected unemployment rate of North Carolina counties?

## Predictors:
- resilience:

## Response:
- unemployment rate:

## EDA:

See .rmd files in folder.

## Model: We will use a multiple linear regression model with the following form:

> unemployment rate = resilience + __ + __ + __ + __

#### Output:

```{r}

sample_data <- sample_data %>%
  mutate(some_college_or_associate_s_degree_2014_18 = as.numeric(some_college_or_associate_s_degree_2014_18))

full_model <- lm(unemployment_change ~ 
                   retail_avg +
                 grocery_avg + 
                   workplaces_avg + 
                   residential_avg, 
                 data = sample_data)

int_only_model <- lm(unemployment_change ~ 1, data = sample_data, na.action = na.omit)

aic_model <- step(full_model, scope = formula(int_only_model), direction = "backward")

aic_model %>%
  tidy(conf.int = 3) %>%
  kable(digits = 3)

# model_aic <- step(full_model, direction = "backward")
```


```{r}
sample_data <- sample_data %>%
  rename(somecollege = percent_of_adults_completing_some_college_or_associate_s_degree_2014_18) %>%
  arrange(desc(somecollege))

p1 <- sample_data %>%
  slice(1:1) %>%
  ggplot(aes(x = reorder(county, -somecollege), y = somecollege)) +
  geom_bar(stat = "identity")

p1

p2 <- sample_data %>%
  slice(485:500) %>%
  ggplot(aes(x = reorder(county, -somecollege), y = somecollege)) +
  geom_bar(stat = "identity")

p2
```

